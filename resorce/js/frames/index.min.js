$(function(){var t=$("#template_figure"),e=$("#template_li"),n=$("body>article"),i=$(">section",n),r=$(">aside>section",n),a=$(">ul",r),o=$("body>footer"),s=$(">p>output",o),f=.5*n.width(),d=.5*n.height();i.on({dragstart:function(t){$(this).data("offset",{offsetX:t.offsetX,offsetY:t.offsetY})},dragend:function(t){var e=$(this),n=e.parent(),i=n.children(),r=e.position(),a=e.data("offset"),o=[8,.2*i.length].concat($.map(i,function(t){var e=$(t),n=e.position();return[f-n.left,d-n.top,e.width(),e.height()]})).join(",");e.css({left:r.left+t.offsetX-a.offsetX,top:r.top+t.offsetY-a.offsetY}),s.eq(n.index()).text(o).end().next().attr("href","/frames/save/?txt="+o)}},">figure.curr"),r.on("click",function(){var t=$(this);t.add(i.eq(t.index())).addClass("curr").siblings().removeClass("curr")}),a.on("click",">li",function(){var t=$(this),e=t.parent().parent(),n=i.eq(e.index());t.add(n.children(":eq("+t.index()+")")).add(n).addClass("curr").siblings().removeClass("curr")}),o.on("change","input[type=file]",function(n){var r=$(this).parent().index(),o=Array.from(n.target.files).map(function(t){return{src:window.URL.createObjectURL(t),name:t.name}});return o.length%5!==0?(alert("请完整添加5个方向的图片！"),void $(this).val("")):(i.eq(r).html(t.template(o)),void a.eq(r).html(e.template(o)))})});